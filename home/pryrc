require "#{ENV['HOME']}/.dots/ruby/console_prompt"
require "#{ENV['HOME']}/.dots/ruby/console_colors"

# customize pry prompt
Pry.config.prompt = [
  proc do |object, level, _|
    ConsolePrompt.new(nil, object, level).normal
  end,
  proc do |object, level, _|
    ConsolePrompt.new(nil, object, level).continue
  end
]

# Legible callstack display
def callstack
  colors = CONSOLE_COLORS
  files = []
  lines = []
  methods = []
  caller.each do |line|
    splits = line.gsub(/.*\//,'').split(':',3)
    files << splits[0]
    lines << splits[1]
    methods << splits[2]
  end
  linesize = lines.max { |x,y| x.length <=> y.length }.length
  filesize = files.max { |x,y| x.length <=> y.length }.length
  (1..caller.count-1).each do |i|
    puts colors[:bold] + colors[:cyan] +
    lines[i].to_s.rjust(linesize) + '  ' + colors[:bold] + colors[:red] +
      files[i].to_s.ljust(filesize) + '  ' + colors[:reset] + colors[:magenta] +
      methods[i].to_s
  end
  nil
end

def thanx_caller
  caller.delete_if do |line|
    !line.include?('thanx')
  end
end
